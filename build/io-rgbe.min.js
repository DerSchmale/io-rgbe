var TYMP=function(r){"use strict";var t=function(){};function a(r,t,a){switch(r){case"+X":a.width=t;break;case"-X":a.width=t,a.flipX=!0,console.warn("Flipping horizontal orientation not currently supported");break;case"-Y":a.height=t;break;case"+Y":a.height=t,a.flipY=!0}}function e(r){for(var t,a="";10!==(t=r.data.getUint8(r.offset++));)a+=String.fromCharCode(t);return a}function o(r,t){var a;if(514!==r.data.getUint16(r.offset))throw new Error("Obsolete HDR file version!");return a=function(r,t){for(var a=t.width,e=t.height,o=t.colorCorr,n=new Float32Array(a*e*3),i=0,h=r.offset,f=r.data,s=0;s<e;++s){if(514!==f.getUint16(h))throw new Error("Incorrect scanline start hash");if(f.getUint16(h+2)!==a)throw new Error("Scanline doesn't match picture dimension!");h+=4;for(var c=4*a,u=[],p=0;p<c;){var l=f.getUint8(h++);if(l>128){var g=l-128;l=f.getUint8(h++);for(var d=0;d<g;++d)u[p++]=l}else for(var w=0;w<l;++w)u[p++]=f.getUint8(h++)}for(p=0;p<a;++p){var v=u[p],m=u[p+a],M=u[p+2*a],E=u[p+3*a];E=E?Math.pow(2,E-136):0,n[i++]=v*E*o[0],n[i++]=m*E*o[1],n[i++]=M*E*o[2]}}return n}(r,t),t.flipX&&function(r,t){for(var a=t.width,e=t.height,o=a>>1,i=0;i<e;++i)for(var h=i*a,f=0;f<o;++f){n(r,h+f,h+a-1-f)}}(a,t),t.flipY&&function(r,t){for(var a=t.width,e=t.height,o=e>>1,i=0;i<o;++i)for(var h=i*a,f=(e-1-i)*a,s=0;s<a;++s)n(r,h+s,f+s)}(a,t),a}function n(r,t,a){t*=3,a*=3;for(var e=0;e<3;++e){var o=r[t+e];r[t+e]=r[a+e],r[a+e]=o}}function i(r,t,a){return Math.max(Math.min(r,a),t)}function h(r,t){for(var a=r.length,e=0;e<a;){for(var o=e,n=0,i=0;n<4&&o<a;)for(o+=n,i=n,n=1;o+n<a&&n<127&&r[o]==r[o+n];)n++;for(i>1&&i==o-e&&(t.push(128+i,r[e]),e=o);e<o;){var h=o-e;h>128&&(h=128),t.push(h);for(var f=0;f<h;++f)t.push(r[e+f]);e+=h}n>=4&&(t.push(128+n,r[o]),e+=n)}}return r.HDRImageData=t,r.decodeRGBE=function(r){var t={data:r,offset:0},n=function(r){var t=e(r),o={colorCorr:[1,1,1],exposure:1,gamma:1,width:0,height:0,flipX:!1,flipY:!1};if("#?RADIANCE"!==t&&"#?RGBE"!==t)throw new Error("Incorrect file format!");for(;""!==t;){var n=(t=e(r)).split("=");switch(n[0]){case"GAMMA":o.gamma=parseFloat(n[1]);break;case"FORMAT":if("32-bit_rle_rgbe"!==n[1]&&"32-bit_rle_xyze"!==n[1])throw new Error("Incorrect encoding format!");break;case"EXPOSURE":o.exposure=parseFloat(n[1]);break;case"COLORCORR":o.colorCorr=n[1].replace(/^\s+|\s+$/g,"").split(" ").map((function(r){return parseFloat(r)}))}}var i=(t=e(r)).split(" ");return a(i[0],parseInt(i[1]),o),a(i[2],parseInt(i[3]),o),o}(t);return{width:n.width,height:n.height,exposure:n.exposure,gamma:n.gamma,data:o(t,n)}},r.encodeRGBE=function(r){var t=r instanceof ImageData?function(r){for(var t=new Float32Array(r.width*r.height*3),a=0,e=0;a<t.length;a+=3,e+=4)t[a]=Math.pow(r.data[e]/255,2.2),t[a+1]=Math.pow(r.data[e+1]/255,2.2),t[a+2]=Math.pow(r.data[e+2]/255,2.2);return{data:t,exposure:1,gamma:1,width:r.width,height:r.height}}(r):r,a=t.width,e=t.height,o=t.data,n=[],f="#?RADIANCE\n# Made with derschmale/io-rgbe\nEXPOSURE="+t.exposure+"\nGAMMA="+t.gamma+"\nPRIMARIES=0 0 0 0 0 0 0 0\nFORMAT=32-bit_rle_rgbe\n\n";f+="-Y "+e+" +X "+a+"\n";for(var s=0;s<f.length;++s)n.push(f.charCodeAt(s));for(var c=0,u=0;u<e;++u){n.push(2,2,(65280&a)>>8,255&a);for(var p=[[],[],[],[]],l=0;l<a;++l){var g=o[c++],d=o[c++],w=o[c++],v=Math.max(g,d,w)/256,m=i(Math.ceil(Math.log2(v))+136,0,255),M=1/Math.pow(2,m-136);p[0].push(i(g*M,0,255)),p[1].push(i(d*M,0,255)),p[2].push(i(w*M,0,255)),p[3].push(m)}p.forEach((function(r){return h(r,n)}))}return new Uint8Array(n).buffer},Object.defineProperty(r,"__esModule",{value:!0}),r}({});
